# 01. JPA 소개

> 👩🏼‍🚀 이 글은 김영한님의 ['자바 ORM 표준 JPA 프로그래밍'](https://www.inflearn.com/course/ORM-JPA-Basic)을 공부하며 정리한 것임을 알립니다.

<br>

## 1.1 SQL을 직접 다룰 때 발생하는 문제점

* 관계형 데이터베이스는 가장 대중적이고 신뢰할 수 있는 저장소로, 대부분 관계형 데이터베이스를 저장소로 사용
* 이러한 관계형 데이터베이스를 다루기 위해서는 SQL(구조화 질의어)를 사용하여 전달
* 자바에서는 JDBC API를 사용하여 SQL을 데이터베이스에 전달

### 1. 반복적인 작업

* 객체 중심적으로 짜여진 자바와 데이터 중심으로 짜여진 관계형 데이터베이스는 차이가 존재하므로 바로 저장이 불가, 따라서 중간에서 변환해주어야 하는 과정이 필요
* 이러한 과정은 굉장히 많은 SQL문과 JDBC API를 코드로 작성해야 하는데 이는 지루함의 연속

### 2. SQL에 의존적인 개발

* 연관된 객체를 사용할 수 있을지 없을지는 사용되는 SQL에 달려 있으므로 이는 SQL을 사용하는 계층을 추상화 시켜도 어떤 SQL이 사용되는지 일일이 확인을 해야 함(논리적 종속)
* 이는 즉, 엔티티(모델링한 객체)를 신뢰 할 수 없다는 것과 동일

<br>

## 1.2 패러다임의 불일치

* 현대의 복잡한 애플리케이션은 대부분 객체지향 언어로 개발
* 객체들은 메모리가 아닌 어딘가에 영구적으로 보관, 메서드는 클래스에 이미 정의되어 있으므로 객체 인스턴스의 속성만 따로 저장 및 복구
* 단순한 객체의 경우 파일 혹은 데이터베이스에 저장하면 되지만, 상속 받는다거나 참조를 하고 있다면 저장하기 쉽지 않음  
  예) 축구 선수라는 객체를 저장, 해당 객체는 팀을 참조 형태로 가지고 있음
  단순히 축구 선수만 저장한다면 해당 선수는 팀 객체를 잃어버림
* 대체안으로 자바에서는 직렬화/역직렬화를 제공하지만 이는 직렬화 되어있는 객체를 검색하기가 어려움
* 현실적으로는 관계형 데이터베이스에 저장하는 것이지만 이는 데이터 중심으로 구조화되어 있으며, 객체지향에서의 추상화, 상속, 다형성과 같은 개념이 존재하지 않음
* 이를 객체와 관계형 데이터베이스의 **패러다임 불일치**라고 함

### 1. 상속

* 객체는 상속이 존재, 테이블은 상속이란 기능이 존재하지 않음
* 슈퍼타입과 서브타입 관계를 사용하면 테이블에서 상속과 비슷하게 설계는 가능
* 하지만 이는 한번에 조회하는 SQL은 존재하지 않아 작성해야 할 코드가 많고, 자식 타입에 따라 'DTYPE'도 저장

### 2. 연관관계

* 객체 - 참조를 통해 연관된 객체 접근  
  테이블 - 외래키 가지고 조인을 사용하여 연관된 테이블 조회
* 객체는 참조가 존재하는 방향으로만 조회가 가능하나 테이블은 외래키 하나로 양방향으로 조회가 가능
* 객체를 테이블에 맞추어 외래키를 사용하여 연관관계를 저장하면 테이블에 저장/ 조회는 편리
* 그러나 객체에서 참조를 통해 바로 접근은 불가능하며 객체지향의 특징을 잃어버리기 쉬움

### 3. 객체 그래프 탐색

* 객체는 참조를 통해 연관된 객체를 계속해서 탐색할 수 있음, 이를 **객체 그래프 탐색**이라 함  
  `축구 선수 → 팀 → 구단주`라는 방향으로 참조가 되어 있을 시에 축구 선수에서 구단주까지 탐색 가능
* 반면 SQL은 객체 그래프를 탐색할 수 있는 구간이 정해짐
* 이는 언제 연결고리가 끊어질지 모르는 객체 그래프에서는 치명적
* 또, 이를 확인하기 위해서는 SQL을 직접 확인(논리적 종속)

### 4. 비교

* 데이터베이스에서는 기본 키를 기준으로 각 로우를 구분, 객체는 동일성(주소 값을 비교)과 동등성(내부 값을 비교) 비교라는 두가지 방법으로 객체를 구분

<br>

## 1.3 JPA란 무엇인가?

* JPA(Java Persistence API)는 자바 진영의 ORM 기술 표준, 애플리케이션과 JDBC API 사이에서 동작
* ORM(Object-Relational Mapping)은 객체와 관계형 데이터베이스를 매핑하는 것으로 객체와 테이블의 패러다임 불일치로 생기는 문제점을 개발자 대신 해결
* 따라서 개발자는 개발에 집중할 수 있는 환경을 조성

### 소개

* 과거 자바 진영은 EJB(Enterprise Java Beans)라는 기술 표준이 존재, 그 안에 엔티티 빈이라는 ORM 기술 포함
* 이는 굉장히 복잡하고 기술의 성숙도가 떨어지며 자바 엔터프라이즈 애플리케이션 서버에서만 동작
* 이때 하이버네이트란 오픈소스 ORM이 등장, 이전 엔티티 빈의 문제점들을 모두 해결
* EJB 3.0에서 하이버네이트 기반으로 새로운 자바 ORM 기술 표준이 생성, 이가 바로 JPA
* 즉, JPA는 자바 ORM 기술에 대한 API 표준 명세

### 사용하는 이유

* 생산성 ↑

  > JPA를 사용하면 자바 컬렉션에 객체를 저장하듯 데이터베이스에 객체를 전달하여 저장 가능  
  > 이는 JPA에서 알아서 해주며 CRUD와 같은 반복적인 코드를 개발자가 직접 사용하지 않아도 됨

* 유지보수 ↑

  > 개발자가 기존에 신경써야 했던 SQL문, JDBC API 코드 등을 JPA에서 처리하므로 유지보수할 코드의 양이 줄어듦

* 패러다임의 불일치 해결

* 성능

  > 데이터베이스에 여러번 접근하여 가져올 데이터들도 재사용하여 기존 코드보다 더 높은 성능을 보여줌

* 데이터 접근 추상화, 벤더 독립성

  > 애플리케이션과 데이터베이스 사이에 추상화된 계층을 제공하여 특정 데이터베이스에 종속되지 않도록 함

* 표준